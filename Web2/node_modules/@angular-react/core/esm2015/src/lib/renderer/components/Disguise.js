// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
import * as tslib_1 from "tslib";
import * as React from 'react';
import * as ReactDOM from 'react-dom';
import { getPassProps } from '../../renderer/pass-prop-decorator';
import removeUndefinedProperties from '../../utils/object/remove-undefined-properties';
import { ReactContent } from '../react-content';
/**
 * A React component that can render a component and its children as other component types.
 */
export class Disguise extends React.PureComponent {
    render() {
        const _a = this.props, { disguiseRootAs, disguiseChildrenAs, children, ngChildComponents } = _a, rest = tslib_1.__rest(_a, ["disguiseRootAs", "disguiseChildrenAs", "children", "ngChildComponents"]);
        const Root = disguiseRootAs || React.Fragment;
        const renderedChildren = ngChildComponents
            ? this._isReactContentOnlyChild()
                ? this._renderReactContentChildren()
                : this._renderChildrenNaive()
            : children;
        return React.createElement(Root, rest || null, renderedChildren);
    }
    _isReactContentOnlyChild() {
        const { children } = this.props;
        if (React.Children.count(children) === 1) {
            const [onlyChild] = React.Children.toArray(children);
            if (typeof onlyChild === 'object' && onlyChild.type === ReactContent) {
                return true;
            }
        }
        return false;
    }
    _renderReactContentChildren() {
        const { ngChildComponents, disguiseChildrenAs } = this.props;
        const renderedChildren = ngChildComponents.map((child, index) => {
            const propsToPass = removeUndefinedProperties(getPassProps(child).reduce((acc, passProp) => Object.assign(acc, { [passProp.targetKey]: child[passProp.sourceKey] }), {}));
            return React.createElement(disguiseChildrenAs, Object.assign({}, propsToPass, { key: index, ref: childReactElement => {
                    // ref callback is called with null when the component unmounts from the DOM, we don't need to handle it.
                    if (!childReactElement) {
                        return;
                    }
                    ReactDOM.findDOMNode(childReactElement).appendChild(child.elementRef.nativeElement);
                } }));
        });
        return renderedChildren;
    }
    _renderChildrenNaive() {
        const { children, disguiseChildrenAs } = this.props;
        const renderedChildren = React.Children.map(children, child => {
            if (!disguiseChildrenAs || typeof child !== 'object') {
                return child;
            }
            const ChildRoot = child.type || disguiseChildrenAs;
            return React.createElement(ChildRoot, Object.assign({}, child.props, { key: child.key }), child);
        });
        return renderedChildren;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGlzZ3Vpc2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYW5ndWxhci1yZWFjdC9jb3JlLyIsInNvdXJjZXMiOlsic3JjL2xpYi9yZW5kZXJlci9jb21wb25lbnRzL0Rpc2d1aXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDREQUE0RDtBQUM1RCxrQ0FBa0M7O0FBRWxDLE9BQU8sS0FBSyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQy9CLE9BQU8sS0FBSyxRQUFRLE1BQU0sV0FBVyxDQUFDO0FBRXRDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUNsRSxPQUFPLHlCQUF5QixNQUFNLGdEQUFnRCxDQUFDO0FBQ3ZGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQXlCaEQ7O0dBRUc7QUFDSCxNQUFNLE9BQU8sUUFBUyxTQUFRLEtBQUssQ0FBQyxhQUE0QjtJQUM5RCxNQUFNO1FBQ0osTUFBTSxlQUF5RixFQUF6RixFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxRQUFRLEVBQUUsaUJBQWlCLE9BQXdCLEVBQXRCLG9HQUFzQixDQUFDO1FBQ2hHLE1BQU0sSUFBSSxHQUFHLGNBQWMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDO1FBRTlDLE1BQU0sZ0JBQWdCLEdBQUcsaUJBQWlCO1lBQ3hDLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUU7Z0JBQy9CLENBQUMsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEVBQUU7Z0JBQ3BDLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUU7WUFDL0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQztRQUViLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxJQUFJLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFTyx3QkFBd0I7UUFDOUIsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFaEMsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDeEMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JELElBQUksT0FBTyxTQUFTLEtBQUssUUFBUSxJQUF3QixTQUFVLENBQUMsSUFBSSxLQUFLLFlBQVksRUFBRTtnQkFDekYsT0FBTyxJQUFJLENBQUM7YUFDYjtTQUNGO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU8sMkJBQTJCO1FBQ2pDLE1BQU0sRUFBRSxpQkFBaUIsRUFBRSxrQkFBa0IsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFN0QsTUFBTSxnQkFBZ0IsR0FBRyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDOUQsTUFBTSxXQUFXLEdBQUcseUJBQXlCLENBQzNDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQ3hCLENBQUMsR0FBRyxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFDMUYsRUFBRSxDQUNILENBQ0YsQ0FBQztZQUVGLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FBQyxrQkFBa0Isb0JBQ3hDLFdBQVcsSUFDZCxHQUFHLEVBQUUsS0FBSyxFQUNWLEdBQUcsRUFBRSxpQkFBaUIsQ0FBQyxFQUFFO29CQUN2Qix5R0FBeUc7b0JBQ3pHLElBQUksQ0FBQyxpQkFBaUIsRUFBRTt3QkFDdEIsT0FBTztxQkFDUjtvQkFFRCxRQUFRLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3RGLENBQUMsSUFDRCxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLGdCQUFnQixDQUFDO0lBQzFCLENBQUM7SUFFTyxvQkFBb0I7UUFDMUIsTUFBTSxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7UUFFcEQsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDNUQsSUFBSSxDQUFDLGtCQUFrQixJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtnQkFDcEQsT0FBTyxLQUFLLENBQUM7YUFDZDtZQUVELE1BQU0sU0FBUyxHQUF1QixLQUFNLENBQUMsSUFBSSxJQUFJLGtCQUFrQixDQUFDO1lBQ3hFLE9BQU8sS0FBSyxDQUFDLGFBQWEsQ0FDeEIsU0FBUyxvQkFDZ0IsS0FBTSxDQUFDLEtBQUssSUFBRSxHQUFHLEVBQXNCLEtBQU0sQ0FBQyxHQUFHLEtBQzFFLEtBQUssQ0FDTixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLGdCQUFnQixDQUFDO0lBQzFCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcblxyXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XHJcbmltcG9ydCAqIGFzIFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XHJcbmltcG9ydCB7IFJlYWN0V3JhcHBlckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2NvbXBvbmVudHMvd3JhcHBlci1jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBnZXRQYXNzUHJvcHMgfSBmcm9tICcuLi8uLi9yZW5kZXJlci9wYXNzLXByb3AtZGVjb3JhdG9yJztcclxuaW1wb3J0IHJlbW92ZVVuZGVmaW5lZFByb3BlcnRpZXMgZnJvbSAnLi4vLi4vdXRpbHMvb2JqZWN0L3JlbW92ZS11bmRlZmluZWQtcHJvcGVydGllcyc7XHJcbmltcG9ydCB7IFJlYWN0Q29udGVudCB9IGZyb20gJy4uL3JlYWN0LWNvbnRlbnQnO1xyXG5pbXBvcnQgeyBSZWFjdEVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XHJcblxyXG4vKipcclxuICogUHJvcHMgZm9yIGBEaXNndWlzZWAgY29tcG9uZW50LlxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBEaXNndWlzZVByb3BzIHtcclxuICAvKipcclxuICAgKiBUaGUgdHlwZSB0byByZW5kZXIgdGhlIHJvb3QgY29tcG9uZW50IGFzLlxyXG4gICAqIEBkZWZhdWx0IFJlYWN0LkZyYWdtZW50XHJcbiAgICovXHJcbiAgZGlzZ3Vpc2VSb290QXM/OiBSZWFjdC5SZWFjdFR5cGU7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSB0eXBlIHRvIHJlbmRlciB0aGUgY2hpbGQgY29tcG9uZW50cyBhcy5cclxuICAgKiBAZGVmYXVsdCB0aGUgQ2hpbGRyZW4ncyBvd24gdHlwZS5cclxuICAgKi9cclxuICBkaXNndWlzZUNoaWxkcmVuQXM/OiBSZWFjdC5SZWFjdFR5cGU7XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoZSBBbmd1bGFyIGNoaWxkIGNvbXBvbmVudHMgdG8gcmVuZGVyLlxyXG4gICAqL1xyXG4gIG5nQ2hpbGRDb21wb25lbnRzPzogUmVhY3RXcmFwcGVyQ29tcG9uZW50PGFueT5bXTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEEgUmVhY3QgY29tcG9uZW50IHRoYXQgY2FuIHJlbmRlciBhIGNvbXBvbmVudCBhbmQgaXRzIGNoaWxkcmVuIGFzIG90aGVyIGNvbXBvbmVudCB0eXBlcy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBEaXNndWlzZSBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQ8RGlzZ3Vpc2VQcm9wcz4ge1xyXG4gIHJlbmRlcigpIHtcclxuICAgIGNvbnN0IHsgZGlzZ3Vpc2VSb290QXMsIGRpc2d1aXNlQ2hpbGRyZW5BcywgY2hpbGRyZW4sIG5nQ2hpbGRDb21wb25lbnRzLCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xyXG4gICAgY29uc3QgUm9vdCA9IGRpc2d1aXNlUm9vdEFzIHx8IFJlYWN0LkZyYWdtZW50O1xyXG5cclxuICAgIGNvbnN0IHJlbmRlcmVkQ2hpbGRyZW4gPSBuZ0NoaWxkQ29tcG9uZW50c1xyXG4gICAgICA/IHRoaXMuX2lzUmVhY3RDb250ZW50T25seUNoaWxkKClcclxuICAgICAgICA/IHRoaXMuX3JlbmRlclJlYWN0Q29udGVudENoaWxkcmVuKClcclxuICAgICAgICA6IHRoaXMuX3JlbmRlckNoaWxkcmVuTmFpdmUoKVxyXG4gICAgICA6IGNoaWxkcmVuO1xyXG5cclxuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFJvb3QsIHJlc3QgfHwgbnVsbCwgcmVuZGVyZWRDaGlsZHJlbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9pc1JlYWN0Q29udGVudE9ubHlDaGlsZCgpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHsgY2hpbGRyZW4gfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgaWYgKFJlYWN0LkNoaWxkcmVuLmNvdW50KGNoaWxkcmVuKSA9PT0gMSkge1xyXG4gICAgICBjb25zdCBbb25seUNoaWxkXSA9IFJlYWN0LkNoaWxkcmVuLnRvQXJyYXkoY2hpbGRyZW4pO1xyXG4gICAgICBpZiAodHlwZW9mIG9ubHlDaGlsZCA9PT0gJ29iamVjdCcgJiYgKDxSZWFjdEVsZW1lbnQ8YW55Pj5vbmx5Q2hpbGQpLnR5cGUgPT09IFJlYWN0Q29udGVudCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfcmVuZGVyUmVhY3RDb250ZW50Q2hpbGRyZW4oKSB7XHJcbiAgICBjb25zdCB7IG5nQ2hpbGRDb21wb25lbnRzLCBkaXNndWlzZUNoaWxkcmVuQXMgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgY29uc3QgcmVuZGVyZWRDaGlsZHJlbiA9IG5nQ2hpbGRDb21wb25lbnRzLm1hcCgoY2hpbGQsIGluZGV4KSA9PiB7XHJcbiAgICAgIGNvbnN0IHByb3BzVG9QYXNzID0gcmVtb3ZlVW5kZWZpbmVkUHJvcGVydGllcyhcclxuICAgICAgICBnZXRQYXNzUHJvcHMoY2hpbGQpLnJlZHVjZShcclxuICAgICAgICAgIChhY2MsIHBhc3NQcm9wKSA9PiBPYmplY3QuYXNzaWduKGFjYywgeyBbcGFzc1Byb3AudGFyZ2V0S2V5XTogY2hpbGRbcGFzc1Byb3Auc291cmNlS2V5XSB9KSxcclxuICAgICAgICAgIHt9XHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzZ3Vpc2VDaGlsZHJlbkFzLCB7XHJcbiAgICAgICAgLi4ucHJvcHNUb1Bhc3MsXHJcbiAgICAgICAga2V5OiBpbmRleCxcclxuICAgICAgICByZWY6IGNoaWxkUmVhY3RFbGVtZW50ID0+IHtcclxuICAgICAgICAgIC8vIHJlZiBjYWxsYmFjayBpcyBjYWxsZWQgd2l0aCBudWxsIHdoZW4gdGhlIGNvbXBvbmVudCB1bm1vdW50cyBmcm9tIHRoZSBET00sIHdlIGRvbid0IG5lZWQgdG8gaGFuZGxlIGl0LlxyXG4gICAgICAgICAgaWYgKCFjaGlsZFJlYWN0RWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgUmVhY3RET00uZmluZERPTU5vZGUoY2hpbGRSZWFjdEVsZW1lbnQpLmFwcGVuZENoaWxkKGNoaWxkLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gcmVuZGVyZWRDaGlsZHJlbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3JlbmRlckNoaWxkcmVuTmFpdmUoKSB7XHJcbiAgICBjb25zdCB7IGNoaWxkcmVuLCBkaXNndWlzZUNoaWxkcmVuQXMgfSA9IHRoaXMucHJvcHM7XHJcblxyXG4gICAgY29uc3QgcmVuZGVyZWRDaGlsZHJlbiA9IFJlYWN0LkNoaWxkcmVuLm1hcChjaGlsZHJlbiwgY2hpbGQgPT4ge1xyXG4gICAgICBpZiAoIWRpc2d1aXNlQ2hpbGRyZW5BcyB8fCB0eXBlb2YgY2hpbGQgIT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgcmV0dXJuIGNoaWxkO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBDaGlsZFJvb3QgPSAoPFJlYWN0RWxlbWVudDxhbnk+PmNoaWxkKS50eXBlIHx8IGRpc2d1aXNlQ2hpbGRyZW5BcztcclxuICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXHJcbiAgICAgICAgQ2hpbGRSb290LFxyXG4gICAgICAgIHsgLi4uKDxSZWFjdEVsZW1lbnQ8YW55Pj5jaGlsZCkucHJvcHMsIGtleTogKDxSZWFjdEVsZW1lbnQ8YW55Pj5jaGlsZCkua2V5IH0sXHJcbiAgICAgICAgY2hpbGRcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiByZW5kZXJlZENoaWxkcmVuO1xyXG4gIH1cclxufVxyXG4iXX0=